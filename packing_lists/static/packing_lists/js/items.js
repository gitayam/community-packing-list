(()=>{"use strict";var e,t={686:(e,t,s)=>{var a=s(83);function i(){const e=document.querySelector("[name=csrfmiddlewaretoken]");return e?.value||""}a.A.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",a.A.defaults.headers.common["Content-Type"]="application/json";class n{static instance;constructor(){}static getInstance(){return n.instance||(n.instance=new n),n.instance}async get(e){try{return(await a.A.get(e)).data}catch(e){throw console.error("API GET error:",e),e}}async post(e,t){try{const s={"X-CSRFToken":i()};return t instanceof FormData&&delete s["Content-Type"],(await a.A.post(e,t,{headers:s})).data}catch(e){throw console.error("API POST error:",e),e}}async vote(e,t){const s=new FormData;s.append("price_id",e.toString()),s.append("vote_type",t);try{return(await a.A.post("/handle_vote/",s,{headers:{"X-CSRFToken":i()}})).data}catch(e){throw console.error("Vote error:",e),e}}}class r{static getElement(e){return document.querySelector(e)}static getElementOrThrow(e){const t=this.getElement(e);if(!t)throw new Error(`Element not found: ${e}`);return t}static getElements(e){return Array.from(document.querySelectorAll(e))}static createElement(e,t={},s){const a=document.createElement(e);return Object.entries(t).forEach(([e,t])=>{a.setAttribute(e,t)}),s&&(a.textContent=s),a}static addEventListeners(e,t){Object.entries(t).forEach(([t,s])=>{e.addEventListener(t,s)})}static removeEventListeners(e,t){Object.entries(t).forEach(([t,s])=>{e.removeEventListener(t,s)})}}class c{static getFormData(e){return new FormData(e)}static getFormDataAsObject(e){const t=new FormData(e),s={};for(const[e,a]of t.entries())s[e]=a;return s}static setFormData(e,t){Object.entries(t).forEach(([t,s])=>{const a=e.querySelector(`[name="${t}"]`);a&&("checkbox"===a.type?a.checked=Boolean(s):a.value=String(s))})}static clearForm(e){e.reset()}static validateForm(e){return e.checkValidity()}static showFormErrors(e,t){e.querySelectorAll(".form-field-errors").forEach(e=>e.remove()),Object.entries(t).forEach(([t,s])=>{const a=e.querySelector(`[name="${t}"]`);if(a){const e=r.createElement("ul",{class:"form-field-errors"});s.forEach(t=>{const s=r.createElement("li",{},t);e.appendChild(s)}),a.parentNode?.insertBefore(e,a.nextSibling)}})}}n.getInstance();var o,l=s(591),d=s(24),h=s(744);class u{}class m extends u{cache=new Map;get(e){return this.cache.get(e)||null}set(e,t){this.cache.set(e,t)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}keys(){return Array.from(this.cache.keys())}size(){return this.cache.size}}class g extends u{prefix="cache_";get(e){try{const t=localStorage.getItem(this.prefix+e);return t?JSON.parse(t):null}catch{return null}}set(e,t){try{localStorage.setItem(this.prefix+e,JSON.stringify(t))}catch(e){d.vF.warn("Failed to save to localStorage cache","cache",e)}}delete(e){try{return localStorage.removeItem(this.prefix+e),!0}catch{return!1}}clear(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s?.startsWith(this.prefix)&&e.push(s)}e.forEach(e=>localStorage.removeItem(e))}keys(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s?.startsWith(this.prefix)&&e.push(s.substring(this.prefix.length))}return e}size(){return this.keys().length}}!function(e){e.LRU="lru",e.LFU="lfu",e.FIFO="fifo",e.TTL="ttl"}(o||(o={}));class p{static instance;backends=new Map;defaultBackend="memory";maxSize=1e3;defaultTTL=3e5;stats={hitCount:0,missCount:0};evictionStrategy=o.LRU;constructor(){this.backends.set("memory",new m),this.backends.set("localStorage",new g),this.startCleanupInterval(),d.vF.info("CacheService initialized","cache",{backends:Array.from(this.backends.keys()),maxSize:this.maxSize,defaultTTL:this.defaultTTL})}static getInstance(){return p.instance||(p.instance=new p),p.instance}configure(e){void 0!==e.maxSize&&(this.maxSize=e.maxSize),void 0!==e.defaultTTL&&(this.defaultTTL=e.defaultTTL),void 0!==e.evictionStrategy&&(this.evictionStrategy=e.evictionStrategy),d.vF.info("Cache configuration updated","cache",e)}get(e,t=this.defaultBackend){const s=this.backends.get(t);if(!s)return d.vF.warn(`Cache backend not found: ${t}`,"cache"),null;const a=s.get(e);if(!a)return this.stats.missCount++,d.vF.debug(`Cache miss: ${e}`,"cache"),null;const i=Date.now();return i>a.timestamp+a.ttl?(s.delete(e),this.stats.missCount++,d.vF.debug(`Cache expired: ${e}`,"cache"),null):(a.accessCount++,a.lastAccess=i,s.set(e,a),this.stats.hitCount++,d.vF.debug(`Cache hit: ${e}`,"cache"),a.value)}set(e,t,s={},a=this.defaultBackend){const i=this.backends.get(a);if(!i)return void d.vF.warn(`Cache backend not found: ${a}`,"cache");const n=Date.now(),r=s.ttl??this.defaultTTL,c=s.priority??1,o=s.tags??[],l={value:t,timestamp:n,ttl:r,accessCount:1,lastAccess:n,priority:c,size:this.calculateSize(t),tags:o};i.size()>=this.maxSize&&this.evict(a,1),i.set(e,l),d.vF.debug(`Cache set: ${e}`,"cache",{ttl:r,priority:c,tags:o,size:l.size})}delete(e,t=this.defaultBackend){const s=this.backends.get(t);if(!s)return!1;const a=s.delete(e);return a&&d.vF.debug(`Cache delete: ${e}`,"cache"),a}has(e,t=this.defaultBackend){const s=this.backends.get(t);if(!s)return!1;const a=s.get(e);return!!a&&!(Date.now()>a.timestamp+a.ttl&&(s.delete(e),1))}async getOrSet(e,t,s={},a=this.defaultBackend){const i=this.get(e,a);if(null!==i)return i;const n=d.vF.createTimer(`cache_factory_${e}`);try{const i=await t();return n.end({cache_miss:!0}),this.set(e,i,s,a),i}catch(e){throw n.end({error:!0}),e}}invalidateByTags(e,t=this.defaultBackend){const s=this.backends.get(t);if(!s)return 0;const a=s.keys();let i=0;return a.forEach(t=>{const a=s.get(t);a&&a.tags.some(t=>e.includes(t))&&(s.delete(t),i++)}),i>0&&d.vF.info(`Invalidated ${i} cache entries by tags`,"cache",{tags:e}),i}invalidateByPattern(e,t=this.defaultBackend){const s=this.backends.get(t);if(!s)return 0;const a=s.keys();let i=0;return a.forEach(t=>{e.test(t)&&(s.delete(t),i++)}),i>0&&d.vF.info(`Invalidated ${i} cache entries by pattern`,"cache",{pattern:e.source}),i}async warm(e,t=this.defaultBackend){d.vF.info(`Warming cache with ${e.length} entries`,"cache");const s=d.vF.createTimer("cache_warm"),a=e.map(async({key:e,factory:s,options:a})=>{try{if(!this.has(e,t)){const i=await s();this.set(e,i,a,t)}}catch(t){d.vF.warn(`Failed to warm cache for key: ${e}`,"cache",t)}});await Promise.allSettled(a),s.end({entryCount:e.length})}clear(e=this.defaultBackend){const t=this.backends.get(e);t&&(t.clear(),d.vF.info(`Cache cleared for backend: ${e}`,"cache"))}clearAll(){this.backends.forEach((e,t)=>{e.clear(),d.vF.info(`Cache cleared for backend: ${t}`,"cache")})}getStats(e=this.defaultBackend){const t=this.backends.get(e);if(!t)return{totalEntries:0,totalSize:0,hitCount:this.stats.hitCount,missCount:this.stats.missCount,hitRate:0};const s=t.keys();let a,i,n=0;s.forEach(e=>{const s=t.get(e);s&&(n+=s.size,(!a||s.timestamp<a)&&(a=s.timestamp),(!i||s.timestamp>i)&&(i=s.timestamp))});const r=this.stats.hitCount+this.stats.missCount,c=r>0?this.stats.hitCount/r:0;return{totalEntries:s.length,totalSize:n,hitCount:this.stats.hitCount,missCount:this.stats.missCount,hitRate:c,oldestEntry:a,newestEntry:i}}evict(e,t){const s=this.backends.get(e);if(!s)return;const a=s.keys().map(e=>({key:e,entry:s.get(e)})).filter(({entry:e})=>e);let i=[];switch(this.evictionStrategy){case o.LRU:a.sort((e,t)=>e.entry.lastAccess-t.entry.lastAccess),i=a.slice(0,t).map(({key:e})=>e);break;case o.LFU:a.sort((e,t)=>e.entry.accessCount-t.entry.accessCount),i=a.slice(0,t).map(({key:e})=>e);break;case o.FIFO:a.sort((e,t)=>e.entry.timestamp-t.entry.timestamp),i=a.slice(0,t).map(({key:e})=>e);break;case o.TTL:a.sort((e,t)=>e.entry.timestamp+e.entry.ttl-(t.entry.timestamp+t.entry.ttl)),i=a.slice(0,t).map(({key:e})=>e)}i.sort((e,t)=>{const a=s.get(e),i=s.get(t);return a.priority-i.priority}),i.slice(0,t).forEach(e=>{s.delete(e)}),i.length>0&&d.vF.info(`Evicted ${i.length} cache entries`,"cache",{strategy:this.evictionStrategy,backend:e})}calculateSize(e){return null==e?0:2*JSON.stringify(e).length}startCleanupInterval(){setInterval(()=>{this.cleanup()},6e4)}cleanup(){const e=Date.now();let t=0;this.backends.forEach(s=>{s.keys().forEach(a=>{const i=s.get(a);i&&e>i.timestamp+i.ttl&&(s.delete(a),t++)})}),t>0&&d.vF.debug(`Cleaned up ${t} expired cache entries`,"cache")}}p.getInstance();const f={ttl:3e4,priority:1};var y=s(734);class v{unsubscribe;constructor(){this.initialize()}initialize(){d.vF.info("Initializing ItemsPageManager","items"),this.setupStateManagement(),this.setupEventListeners(),this.setupViewToggle(),this.preloadData()}setupStateManagement(){this.unsubscribe=h.XJ.subscribe((e,t)=>{this.handleStateChange(e,t)})}handleStateChange(e,t){e.ui.loading!==t.ui.loading&&this.updateLoadingState(e.ui.loading),e.data.selectedItems!==t.data.selectedItems&&this.updateBulkActionsVisibility()}updateLoadingState(e){const t=r.getElement("#loading-indicator");t&&(t.style.display=e?"block":"none")}setupEventListeners(){document.addEventListener("click",this.handlePriceModalClick.bind(this)),document.addEventListener("click",this.handleItemModalClick.bind(this)),document.addEventListener("click",this.handlePriceToggleClick.bind(this)),document.addEventListener("change",this.handleSelectionChange.bind(this)),document.addEventListener("click",this.handleBulkActions.bind(this)),document.addEventListener("change",this.handleBaseChange.bind(this))}async handlePriceModalClick(e){const t=e.target;if(t.closest(".add-price-btn")||t.closest(".edit-price-btn")){d.vF.logUserAction("price_modal_open",{target:t.className}),e.preventDefault(),e.stopPropagation();const s=t.closest(".add-price-btn, .edit-price-btn"),a=s.dataset.itemId,i=s.dataset.priceId;if(!a)return;d.vF.debug("Opening price modal","items",{itemId:a,priceId:i}),this.showButtonLoading(s);try{let e=`/item/${a}/add_price_modal/`;i&&(e+=`?price_id=${i}`);const t=await l.K.get(e,{useCache:!0,cacheTimeout:f.ttl});if(t.html){const e=document.createElement("div");e.innerHTML=t.html;const s=new y.a({title:i?"Edit Price":"Add Price",content:e,size:"md"});s.on("open",()=>{const t=e.querySelector("form");t&&this.setupPriceFormSubmission(t),setTimeout(()=>{const t=e.querySelector("input, select, textarea");t&&t.focus()},100)}),await s.open()}}catch(e){d.vF.error("Error loading price modal","items",e),h.ph.addNotification("Error loading price form. Please try again.","error")}finally{const e=s.classList.contains("add-price-btn")?"Add Price":"Edit";this.hideButtonLoading(s,e)}}}async handleItemModalClick(e){const t=e.target;if(t.closest(".edit-item-btn")){e.preventDefault(),e.stopPropagation();const s=t.closest(".edit-item-btn"),a=s.dataset.itemId;if(!a)return;this.showButtonLoading(s);try{const e=`/item/${a}/edit_modal/`,t=await l.K.get(e,{useCache:!1});if(t.html){const e=document.createElement("div");e.innerHTML=t.html;const s=new y.a({title:"Edit Item",content:e,size:"md"});s.on("open",()=>{const t=e.querySelector("form");t&&this.setupItemFormSubmission(t)}),await s.open()}}catch(e){d.vF.error("Error loading item modal","items",e),h.ph.addNotification("Error loading edit form. Please try again.","error")}finally{this.hideButtonLoading(s,"Edit")}}}handlePriceToggleClick(e){const t=e.target;if(t.textContent?.includes("Show All")||t.textContent?.includes("Hide Prices")){const e=t,s=e.nextElementSibling;s&&s.classList.contains("all-prices")&&("none"!==s.style.display&&s.style.display?(s.style.display="none",e.textContent="Show All Prices"):(s.style.display="block",e.textContent="Hide Prices"))}}handleSelectionChange(e){const t=e.target;if(t.classList.contains("item-select")){const e=t,s=e.value;e.checked?(h.ph.addSelectedItem(s),d.vF.logUserAction("item_selected",{itemId:s})):(h.ph.removeSelectedItem(s),d.vF.logUserAction("item_deselected",{itemId:s}))}}handleBulkActions(e){const t=e.target;t.textContent?.includes("Clear Selection")?this.clearSelection():t.textContent?.includes("Create Packing List")&&this.createPackingListFromSelected()}handleBaseChange(e){const t=e.target;if("base"===t.id){const e=t,s=r.getElement("#city"),a=r.getElement("#state");e.value?(s&&(s.disabled=!0),a&&(a.disabled=!0)):(s&&(s.disabled=!1),a&&(a.disabled=!1))}}setupViewToggle(){const e=r.getElement("#cardViewBtn"),t=r.getElement("#tableViewBtn");e&&e.addEventListener("click",()=>this.setItemsView("card")),t&&t.addEventListener("click",()=>this.setItemsView("table"))}setItemsView(e){const t=r.getElement("#itemsCardView"),s=r.getElement("#itemsTableView"),a=r.getElement("#cardViewBtn"),i=r.getElement("#tableViewBtn");"card"===e?(t&&(t.style.display="block"),s&&(s.style.display="none"),a&&(a.classList.add("active"),a.setAttribute("aria-pressed","true")),i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false"))):(t&&(t.style.display="none"),s&&(s.style.display="block"),i&&(i.classList.add("active"),i.setAttribute("aria-pressed","true")),a&&(a.classList.remove("active"),a.setAttribute("aria-pressed","false"))),h.ph.updatePreferences({viewMode:e}),d.vF.logUserAction("view_changed",{view:e})}updateBulkActionsVisibility(){const e=h.XJ.getState().data.selectedItems,t=r.getElement("#bulkActions"),s=r.getElement("#selectedCount");e.size>0?(t&&(t.style.display="block"),s&&(s.textContent=`${e.size} item${e.size>1?"s":""} selected`)):t&&(t.style.display="none")}clearSelection(){document.querySelectorAll(".item-select").forEach(e=>{e.checked=!1}),h.ph.clearSelectedItems(),d.vF.logUserAction("selection_cleared")}createPackingListFromSelected(){const e=h.XJ.getState().data.selectedItems;if(0===e.size)return void h.ph.addNotification("Please select at least one item.","info");d.vF.logUserAction("create_packing_list_from_selection",{itemCount:e.size});const t=new URLSearchParams;e.forEach(e=>{t.append("selected_items",e)}),window.location.href="/create_packing_list_from_items/?"+t.toString()}setupPriceFormSubmission(e){e.addEventListener("submit",async t=>{if(t.preventDefault(),!e.checkValidity())return void e.reportValidity();const s=e.querySelector('button[type="submit"]'),a=s?s.textContent:"Save Price";s&&this.showButtonLoading(s);try{const t=c.getFormData(e),s=await l.K.post(e.action,t);if(s.success)y.a.alert("Price saved successfully!","Success"),location.reload();else if(s.html){const t=e.parentElement;if(t){t.innerHTML=s.html;const e=t.querySelector("form");e&&this.setupPriceFormSubmission(e)}}else h.ph.addNotification(s.message||"Unknown error occurred","error")}catch(e){d.vF.error("Error submitting price form","items",e),h.ph.addNotification("Error saving price. Please try again.","error")}finally{s&&this.hideButtonLoading(s,a||"Save Price")}})}setupItemFormSubmission(e){e.addEventListener("submit",async t=>{if(t.preventDefault(),!e.checkValidity())return void e.reportValidity();const s=e.querySelector('button[type="submit"]'),a=s?s.textContent:"Save Item";s&&this.showButtonLoading(s);try{const t=c.getFormData(e),s=await l.K.post(e.action,t);if(s.success)y.a.alert("Item updated successfully!","Success"),location.reload();else if(s.html){const t=e.parentElement;if(t){t.innerHTML=s.html;const e=t.querySelector("form");e&&this.setupItemFormSubmission(e)}}else h.ph.addNotification(s.message||"Unknown error occurred","error")}catch(e){d.vF.error("Error submitting item form","items",e),h.ph.addNotification("Error updating item. Please try again.","error")}finally{s&&this.hideButtonLoading(s,a||"Save Item")}})}showButtonLoading(e){e.classList.add("loading"),e.disabled=!0,e.dataset.originalText=e.textContent||"",e.textContent="Loading..."}hideButtonLoading(e,t){e.classList.remove("loading"),e.disabled=!1,e.textContent=t}async preloadData(){try{const e=["/api/user-preferences/","/api/recent-items/"];await l.K.preload(e),d.vF.debug("Data preloading completed","items")}catch(e){d.vF.warn("Failed to preload some data","items",e)}}destroy(){this.unsubscribe&&this.unsubscribe(),d.vF.info("ItemsPageManager destroyed","items")}}function b(){const e=new v;window.itemsManager=e;const t=h.XJ.getState(),s=t.user?.preferences?.viewMode;s&&e.setItemsView(s)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b()}},s={};function a(e){var i=s[e];if(void 0!==i)return i.exports;var n=s[e]={exports:{}};return t[e](n,n.exports,a),n.exports}a.m=t,e=[],a.O=(t,s,i,n)=>{if(!s){var r=1/0;for(d=0;d<e.length;d++){for(var[s,i,n]=e[d],c=!0,o=0;o<s.length;o++)(!1&n||r>=n)&&Object.keys(a.O).every(e=>a.O[e](s[o]))?s.splice(o--,1):(c=!1,n<r&&(r=n));if(c){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,i,n]},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={669:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var i,n,[r,c,o]=s,l=0;if(r.some(t=>0!==e[t])){for(i in c)a.o(c,i)&&(a.m[i]=c[i]);if(o)var d=o(a)}for(t&&t(s);l<r.length;l++)n=r[l],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},s=self.webpackChunkcommunity_packing_list=self.webpackChunkcommunity_packing_list||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var i=a.O(void 0,[804],()=>a(686));i=a.O(i)})();
//# sourceMappingURL=items.js.map