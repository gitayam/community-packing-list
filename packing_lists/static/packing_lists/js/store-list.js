(()=>{"use strict";var t,e={914:(t,e,o)=>{var r=o(83);function n(){const t=document.querySelector("[name=csrfmiddlewaretoken]");return t?.value||""}r.A.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.A.defaults.headers.common["Content-Type"]="application/json";class a{static instance;constructor(){}static getInstance(){return a.instance||(a.instance=new a),a.instance}async get(t){try{return(await r.A.get(t)).data}catch(t){throw console.error("API GET error:",t),t}}async post(t,e){try{const o={"X-CSRFToken":n()};return e instanceof FormData&&delete o["Content-Type"],(await r.A.post(t,e,{headers:o})).data}catch(t){throw console.error("API POST error:",t),t}}async vote(t,e){const o=new FormData;o.append("price_id",t.toString()),o.append("vote_type",e);try{return(await r.A.post("/handle_vote/",o,{headers:{"X-CSRFToken":n()}})).data}catch(t){throw console.error("Vote error:",t),t}}}class s{static getElement(t){return document.querySelector(t)}static getElementOrThrow(t){const e=this.getElement(t);if(!e)throw new Error(`Element not found: ${t}`);return e}static getElements(t){return Array.from(document.querySelectorAll(t))}static createElement(t,e={},o){const r=document.createElement(t);return Object.entries(e).forEach(([t,e])=>{r.setAttribute(t,e)}),o&&(r.textContent=o),r}static addEventListeners(t,e){Object.entries(e).forEach(([e,o])=>{t.addEventListener(e,o)})}static removeEventListeners(t,e){Object.entries(e).forEach(([e,o])=>{t.removeEventListener(e,o)})}}class i{static async getCurrentPosition(){return new Promise((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t,e,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):e(new Error("Geolocation is not supported by your browser."))})}static getErrorMessage(t){switch(t.code){case t.PERMISSION_DENIED:return"User denied the request for Geolocation.";case t.POSITION_UNAVAILABLE:return"Location information is unavailable.";case t.TIMEOUT:return"The request to get user location timed out.";default:return"An unknown error occurred."}}}const d=a.getInstance();var l=o(744),c=o(734);class u{findNearMeButton=null;addStoreButton=null;storeModal=null;storeModalBody=null;closeStoreModalButton=null;currentModal=null;constructor(){this.initialize()}initialize(){this.setupElements(),this.setupEventListeners()}setupElements(){this.findNearMeButton=s.getElement("#find-near-me"),this.addStoreButton=s.getElement("#add-store-btn"),this.storeModal=s.getElement("#store-modal"),this.storeModalBody=s.getElement("#store-modal-body"),this.closeStoreModalButton=s.getElement("#close-store-modal")}setupEventListeners(){this.findNearMeButton&&this.findNearMeButton.addEventListener("click",this.handleFindNearMe.bind(this)),this.addStoreButton&&this.addStoreButton.addEventListener("click",this.handleAddStoreClick.bind(this)),this.closeStoreModalButton&&this.closeStoreModalButton.addEventListener("click",this.handleCloseModal.bind(this)),this.storeModal&&this.storeModal.addEventListener("click",this.handleModalOutsideClick.bind(this))}async handleFindNearMe(){if(this.findNearMeButton)try{const t=await i.getCurrentPosition(),e=s.getElement("#user_lat"),o=s.getElement("#user_lon"),r=s.getElement("#school_id");e&&o&&(e.value=t.coords.latitude.toString(),o.value=t.coords.longitude.toString()),r&&(r.value="");const n=s.getElement(".filter-form form");n&&n.submit()}catch(t){console.error("Geolocation error:",t);let e="Error getting location: ";t instanceof GeolocationPositionError?e+=i.getErrorMessage(t):t instanceof Error?e+=t.message:e+="An unknown error occurred.",l.ph.addNotification(e,"error")}}async handleAddStoreClick(t){t.preventDefault();const e=t.currentTarget,o=e.textContent||"Add Store";this.showButtonLoading(e);try{const t=await d.get("/stores/add/modal/");if(t.html){const e=document.createElement("div");e.innerHTML=t.html,this.currentModal=new c.a({title:"Add Store",content:e,size:"md"}),this.currentModal.on("open",()=>{const t=e.querySelector("form");t&&this.bindStoreFormAjax(t),setTimeout(()=>{const t=e.querySelector("input, select, textarea");t&&t.focus()},100)}),await this.currentModal.open()}}catch(t){c.a.alert("Error loading form. Please try again.","Error")}finally{this.hideButtonLoading(e,o)}}handleCloseModal(){this.currentModal&&this.currentModal.close()}handleModalOutsideClick(t){t.target===this.storeModal&&this.handleCloseModal()}bindStoreFormAjax(t){const e=t||s.getElement("#store-form");e&&e.addEventListener("submit",async t=>{t.preventDefault();const o=e.querySelector('button[type="submit"]');o&&this.showButtonLoading(o);try{const t=new FormData(e),o=await d.post("/stores/add/",t),r=o.data||o;if(r.success)c.a.alert("Store added successfully!","Success"),location.reload();else if(r.html){const t=s.getElement("#store-modal-body");t&&(t.innerHTML=r.html,this.bindStoreFormAjax(e))}else r.message?l.ph.addNotification(r.message,"error"):l.ph.addNotification("Unknown error occurred","error")}catch(t){l.ph.addNotification("Error adding store. Please try again.","error")}finally{o&&this.hideButtonLoading(o,"Add Store")}})}showButtonLoading(t){t.disabled=!0;const e=t.textContent||"";t.textContent="Loading...",t.dataset.originalText=e}hideButtonLoading(t,e){t.disabled=!1,t.textContent=e||t.dataset.originalText||"Submit",delete t.dataset.originalText}}function h(){new u}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}},o={};function r(t){var n=o[t];if(void 0!==n)return n.exports;var a=o[t]={exports:{}};return e[t](a,a.exports,r),a.exports}r.m=e,t=[],r.O=(e,o,n,a)=>{if(!o){var s=1/0;for(c=0;c<t.length;c++){for(var[o,n,a]=t[c],i=!0,d=0;d<o.length;d++)(!1&a||s>=a)&&Object.keys(r.O).every(t=>r.O[t](o[d]))?o.splice(d--,1):(i=!1,a<s&&(s=a));if(i){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[o,n,a]},r.d=(t,e)=>{for(var o in e)r.o(e,o)&&!r.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={791:0};r.O.j=e=>0===t[e];var e=(e,o)=>{var n,a,[s,i,d]=o,l=0;if(s.some(e=>0!==t[e])){for(n in i)r.o(i,n)&&(r.m[n]=i[n]);if(d)var c=d(r)}for(e&&e(o);l<s.length;l++)a=s[l],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(c)},o=self.webpackChunkcommunity_packing_list=self.webpackChunkcommunity_packing_list||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var n=r.O(void 0,[804],()=>r(914));n=r.O(n)})();
//# sourceMappingURL=store-list.js.map