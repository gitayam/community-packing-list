{"version":3,"file":"price-form-modal.js","mappings":"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","sources":["webpack://community-packing-list/./src/price-form-modal.ts"],"sourcesContent":["import { DOMUtils } from './common';\n\ninterface PriceData {\n  price: number;\n  quantity: number;\n  store: string;\n  date: string;\n}\n\ninterface QuickPriceSettings {\n  lastStore: string;\n  recentPrices: number[];\n  autoFillConfidence: string;\n}\n\nclass PriceFormModalManager {\n  private modal: HTMLElement | null = null;\n  private addStoreDiv: HTMLElement | null = null;\n  private storeSelect: HTMLSelectElement | null = null;\n  private storeNameInput: HTMLInputElement | null = null;\n  private priceInput: HTMLInputElement | null = null;\n  private quantityInput: HTMLInputElement | null = null;\n  private confidenceSelect: HTMLSelectElement | null = null;\n  private pricePerUnitDisplay: HTMLElement | null = null;\n  private priceValidationMessage: HTMLElement | null = null;\n  private submitButton: HTMLButtonElement | null = null;\n  private historicalPrices: PriceData[] = [];\n  private currentItemId: string | null = null;\n  private currentListId: string | null = null;\n  private settings!: QuickPriceSettings;\n\n  constructor() {\n    this.loadSettings();\n    this.initialize();\n  }\n\n  private initialize(): void {\n    this.setupElements();\n    this.setupEventListeners();\n    this.setupPriceCalculator();\n    this.setupKeyboardShortcuts();\n    this.setupMobileOptimizations();\n    this.createModal();\n    this.toggleAddStoreSection(); // Initial state\n  }\n\n  private loadSettings(): void {\n    const saved = localStorage.getItem('priceFormSettings');\n    this.settings = saved ? JSON.parse(saved) : {\n      lastStore: '',\n      recentPrices: [],\n      autoFillConfidence: 'medium'\n    };\n  }\n\n  private saveSettings(): void {\n    localStorage.setItem('priceFormSettings', JSON.stringify(this.settings));\n  }\n\n  private setupElements(): void {\n    this.modal = document.getElementById('price-modal');\n    this.addStoreDiv = document.getElementById('inline-add-store');\n    this.storeSelect = document.getElementById('id_store') as HTMLSelectElement;\n    this.storeNameInput = document.getElementById('id_store_name') as HTMLInputElement;\n    this.priceInput = document.getElementById('id_price') as HTMLInputElement;\n    this.quantityInput = document.getElementById('id_quantity') as HTMLInputElement;\n    this.confidenceSelect = document.getElementById('id_confidence') as HTMLSelectElement;\n    this.submitButton = document.querySelector('#price-form button[type=\"submit\"]') as HTMLButtonElement;\n    \n    // Create price per unit display if it doesn't exist\n    if (this.priceInput && !document.getElementById('price-per-unit-display')) {\n      const priceContainer = this.priceInput.parentElement;\n      if (priceContainer) {\n        const pricePerUnitDiv = document.createElement('div');\n        pricePerUnitDiv.id = 'price-per-unit-display';\n        pricePerUnitDiv.className = 'price-calculator mt-2';\n        pricePerUnitDiv.innerHTML = '<small class=\"text-muted\">Price per unit: <span id=\"price-per-unit-value\">--</span></small>';\n        priceContainer.appendChild(pricePerUnitDiv);\n        this.pricePerUnitDisplay = pricePerUnitDiv;\n      }\n    }\n    \n    // Create validation message container\n    if (this.priceInput && !document.getElementById('price-validation-message')) {\n      const priceContainer = this.priceInput.parentElement;\n      if (priceContainer) {\n        const validationDiv = document.createElement('div');\n        validationDiv.id = 'price-validation-message';\n        validationDiv.className = 'price-validation mt-1';\n        priceContainer.appendChild(validationDiv);\n        this.priceValidationMessage = validationDiv;\n      }\n    }\n  }\n\n  private createModal(): void {\n    if (this.modal) return; // Modal already exists\n    \n    this.modal = document.createElement('div');\n    this.modal.id = 'price-modal';\n    this.modal.className = 'modal-overlay';\n    this.modal.innerHTML = `\n      <div class=\"modal-content mobile-optimized\">\n        <div class=\"modal-header\">\n          <h3 id=\"modal-title\">Add Price</h3>\n          <button type=\"button\" class=\"modal-close\" onclick=\"closePriceModal()\">Ã—</button>\n        </div>\n        <div class=\"modal-body\" id=\"price-modal-body\">\n          <!-- Form will be loaded here via AJAX -->\n        </div>\n      </div>\n    `;\n    \n    document.body.appendChild(this.modal);\n    \n    // Add mobile-optimized CSS\n    if (!document.getElementById('price-modal-styles')) {\n      const styles = document.createElement('style');\n      styles.id = 'price-modal-styles';\n      styles.textContent = `\n        .modal-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(0, 0, 0, 0.5);\n          display: none;\n          z-index: 1000;\n          align-items: flex-start;\n          justify-content: center;\n          padding: 20px;\n          box-sizing: border-box;\n          overflow-y: auto;\n        }\n        \n        .modal-content {\n          background: white;\n          border-radius: 8px;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n          width: 100%;\n          max-width: 500px;\n          max-height: 90vh;\n          overflow-y: auto;\n          margin-top: 5vh;\n        }\n        \n        .mobile-optimized {\n          position: relative;\n        }\n        \n        .modal-header {\n          padding: 16px 20px;\n          border-bottom: 1px solid #eee;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          position: sticky;\n          top: 0;\n          background: white;\n          z-index: 1;\n        }\n        \n        .modal-header h3 {\n          margin: 0;\n          font-size: 18px;\n        }\n        \n        .modal-close {\n          background: none;\n          border: none;\n          font-size: 24px;\n          cursor: pointer;\n          padding: 0;\n          width: 32px;\n          height: 32px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 4px;\n        }\n        \n        .modal-close:hover {\n          background: #f5f5f5;\n        }\n        \n        .modal-body {\n          padding: 20px;\n        }\n        \n        .form-group {\n          margin-bottom: 16px;\n        }\n        \n        .form-group label {\n          display: block;\n          margin-bottom: 4px;\n          font-weight: 500;\n          font-size: 14px;\n        }\n        \n        .form-group input,\n        .form-group select,\n        .form-group textarea {\n          width: 100%;\n          padding: 12px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          font-size: 16px;\n          box-sizing: border-box;\n        }\n        \n        .form-group input:focus,\n        .form-group select:focus {\n          outline: none;\n          border-color: #007bff;\n          box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);\n        }\n        \n        .quick-actions {\n          margin: 12px 0;\n        }\n        \n        .btn-group {\n          display: flex;\n          gap: 8px;\n          flex-wrap: wrap;\n        }\n        \n        .btn-group button {\n          flex: 1;\n          min-width: 60px;\n          padding: 8px 12px;\n          border: 1px solid #ddd;\n          background: white;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          transition: all 0.2s;\n        }\n        \n        .btn-group button:hover {\n          background: #f8f9fa;\n          border-color: #007bff;\n        }\n        \n        .btn-group button:active {\n          background: #e9ecef;\n        }\n        \n        .form-actions {\n          margin-top: 24px;\n          display: flex;\n          gap: 12px;\n          justify-content: flex-end;\n          position: sticky;\n          bottom: 0;\n          background: white;\n          padding: 16px 0 0;\n          border-top: 1px solid #eee;\n        }\n        \n        .button {\n          padding: 12px 24px;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 16px;\n          font-weight: 500;\n          min-width: 80px;\n          transition: all 0.2s;\n        }\n        \n        .button.success {\n          background: #28a745;\n          color: white;\n        }\n        \n        .button.success:hover {\n          background: #218838;\n        }\n        \n        .button.success:disabled {\n          background: #6c757d;\n          cursor: not-allowed;\n        }\n        \n        .button.secondary {\n          background: #6c757d;\n          color: white;\n        }\n        \n        .button.secondary:hover {\n          background: #5a6268;\n        }\n        \n        .price-calculator {\n          font-size: 14px;\n          color: #28a745;\n        }\n        \n        .price-validation {\n          font-size: 14px;\n        }\n        \n        .text-success { color: #28a745; }\n        .text-warning { color: #ffc107; }\n        .text-danger { color: #dc3545; }\n        .text-muted { color: #6c757d; }\n        \n        .keyboard-hints {\n          margin-top: 8px;\n          text-align: center;\n        }\n        \n        @media (max-width: 768px) {\n          .modal-overlay {\n            padding: 0;\n            align-items: flex-end;\n          }\n          \n          .modal-content {\n            max-width: 100%;\n            margin-top: 0;\n            border-radius: 12px 12px 0 0;\n            max-height: 85vh;\n          }\n          \n          .modal-header {\n            padding: 12px 16px;\n          }\n          \n          .modal-body {\n            padding: 16px;\n          }\n          \n          .form-group input,\n          .form-group select {\n            font-size: 16px;\n            padding: 14px 12px;\n          }\n          \n          .btn-group {\n            gap: 6px;\n          }\n          \n          .btn-group button {\n            padding: 10px 8px;\n            font-size: 13px;\n          }\n          \n          .form-actions {\n            padding: 12px 0 0;\n          }\n          \n          .button {\n            padding: 14px 20px;\n            font-size: 16px;\n          }\n        }\n      `;\n      document.head.appendChild(styles);\n    }\n  }\n\n  private setupEventListeners(): void {\n    if (this.storeSelect && this.addStoreDiv) {\n      this.storeSelect.addEventListener('change', this.onStoreChange.bind(this));\n    }\n    \n    if (this.priceInput) {\n      this.priceInput.addEventListener('input', this.onPriceInput.bind(this));\n      this.priceInput.addEventListener('blur', this.validatePrice.bind(this));\n    }\n    \n    if (this.quantityInput) {\n      this.quantityInput.addEventListener('input', this.calculatePricePerUnit.bind(this));\n    }\n    \n    // Form submission with AJAX\n    const form = document.getElementById('price-form') as HTMLFormElement;\n    if (form) {\n      form.addEventListener('submit', this.handleFormSubmit.bind(this));\n    }\n    \n    // Modal close events\n    if (this.modal) {\n      this.modal.addEventListener('click', (e) => {\n        if (e.target === this.modal) {\n          this.closeModal();\n        }\n      });\n    }\n  }\n\n  private setupMobileOptimizations(): void {\n    // Prevent zoom on focus for iOS\n    const inputs = document.querySelectorAll('input, select, textarea');\n    inputs.forEach((input) => {\n      if (input instanceof HTMLInputElement || input instanceof HTMLSelectElement) {\n        if (input.style.fontSize === '' || parseFloat(getComputedStyle(input).fontSize) < 16) {\n          input.style.fontSize = '16px';\n        }\n      }\n    });\n    \n    // Add touch-friendly interaction hints\n    document.addEventListener('touchstart', () => {}, {passive: true});\n  }\n\n  private setupPriceCalculator(): void {\n    // Expose global functions for backward compatibility\n    (window as any).calculatePricePerUnit = this.calculatePricePerUnit.bind(this);\n    (window as any).setQuickPrice = this.setQuickPrice.bind(this);\n    (window as any).openPriceModal = this.openModal.bind(this);\n    (window as any).closePriceModal = this.closeModal.bind(this);\n  }\n\n  private setupKeyboardShortcuts(): void {\n    document.addEventListener('keydown', (e) => {\n      // Ctrl/Cmd + Enter to submit form\n      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n        const form = document.getElementById('price-form') as HTMLFormElement;\n        if (form) {\n          form.submit();\n        }\n      }\n      \n      // Escape to close modal\n      if (e.key === 'Escape') {\n        const modal = document.getElementById('price-modal') as HTMLElement;\n        if (modal) {\n          modal.style.display = 'none';\n        }\n      }\n    });\n  }\n\n  private onPriceInput(): void {\n    this.calculatePricePerUnit();\n    this.clearValidationMessage();\n  }\n\n  private calculatePricePerUnit(): void {\n    if (!this.priceInput || !this.quantityInput) return;\n    \n    const price = parseFloat(this.priceInput.value);\n    const quantity = parseInt(this.quantityInput.value);\n    const pricePerUnitSpan = document.getElementById('price-per-unit-value');\n    \n    if (pricePerUnitSpan) {\n      if (price > 0 && quantity > 0) {\n        const pricePerUnit = (price / quantity).toFixed(2);\n        pricePerUnitSpan.textContent = `$${pricePerUnit}`;\n        pricePerUnitSpan.className = 'text-success';\n      } else {\n        pricePerUnitSpan.textContent = '--';\n        pricePerUnitSpan.className = 'text-muted';\n      }\n    }\n  }\n\n  private validatePrice(): void {\n    if (!this.priceInput || !this.priceValidationMessage) return;\n    \n    const price = parseFloat(this.priceInput.value);\n    \n    if (isNaN(price) || price <= 0) {\n      this.showValidationMessage('Please enter a valid price greater than zero.', 'error');\n      return;\n    }\n    \n    if (price > 10000) {\n      this.showValidationMessage('This price seems unusually high. Please verify the amount.', 'warning');\n      return;\n    }\n    \n    if (price < 0.01) {\n      this.showValidationMessage('Price must be at least $0.01.', 'error');\n      return;\n    }\n    \n    // Check against historical prices if available\n    if (this.historicalPrices.length > 0) {\n      const avgPrice = this.historicalPrices.reduce((sum, p) => sum + p.price, 0) / this.historicalPrices.length;\n      \n      if (price > avgPrice * 3) {\n        this.showValidationMessage(`This price is significantly higher than the average ($${avgPrice.toFixed(2)}). Please verify.`, 'warning');\n      } else if (price < avgPrice * 0.3) {\n        this.showValidationMessage(`This price is significantly lower than the average ($${avgPrice.toFixed(2)}). Please verify.`, 'warning');\n      } else {\n        this.showValidationMessage('Price looks reasonable based on historical data.', 'success');\n      }\n    }\n  }\n\n  private showValidationMessage(message: string, type: 'success' | 'warning' | 'error'): void {\n    if (!this.priceValidationMessage) return;\n    \n    this.priceValidationMessage.innerHTML = `\n      <small class=\"text-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'danger'}\">\n        ${message}\n      </small>\n    `;\n  }\n\n  private clearValidationMessage(): void {\n    if (this.priceValidationMessage) {\n      this.priceValidationMessage.innerHTML = '';\n    }\n  }\n\n  private toggleAddStoreSection(): void {\n    if (!this.storeSelect || !this.addStoreDiv) return;\n\n    if (this.storeSelect.value === '__add_new__') {\n      this.addStoreDiv.style.display = 'block';\n      if (this.storeNameInput) {\n        this.storeNameInput.required = true;\n        this.storeNameInput.focus();\n      }\n    } else {\n      this.addStoreDiv.style.display = 'none';\n      if (this.storeNameInput) {\n        this.storeNameInput.required = false;\n        this.storeNameInput.value = '';\n      }\n    }\n  }\n\n  // Public method to set historical prices for validation\n  public setHistoricalPrices(prices: PriceData[]): void {\n    this.historicalPrices = prices;\n  }\n\n  // Quick price setting method\n  private setQuickPrice(price: number): void {\n    if (this.priceInput) {\n      this.priceInput.value = price.toFixed(2);\n      this.priceInput.focus();\n      this.calculatePricePerUnit();\n      this.validatePrice();\n    }\n  }\n\n  // Store selection with memory\n  private onStoreChange(): void {\n    this.toggleAddStoreSection();\n    \n    if (this.storeSelect && this.storeSelect.value && this.storeSelect.value !== '__add_new__') {\n      // Remember the selected store\n      this.settings.lastStore = this.storeSelect.value;\n      this.saveSettings();\n    }\n  }\n\n  // Modal management methods\n  public async openModal(itemId: string, listId?: string, priceId?: string): Promise<void> {\n    this.currentItemId = itemId;\n    this.currentListId = listId || null;\n    \n    if (!this.modal) {\n      this.createModal();\n    }\n    \n    try {\n      // Load form content via AJAX\n      const url = listId \n        ? `/item/${itemId}/add_price_modal/to_list/${listId}/`\n        : `/item/${itemId}/add_price_modal/`;\n      \n      const response = await fetch(url, {\n        headers: {\n          'X-Requested-With': 'XMLHttpRequest',\n        }\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to load price form');\n      }\n      \n      const html = await response.text();\n      const modalBody = this.modal!.querySelector('#price-modal-body');\n      if (modalBody) {\n        modalBody.innerHTML = html;\n      }\n      \n      // Re-setup elements after loading new content\n      this.setupElements();\n      this.setupEventListeners();\n      \n      // Pre-fill with remembered store\n      if (this.settings.lastStore && this.storeSelect) {\n        const option = this.storeSelect.querySelector(`option[value=\"${this.settings.lastStore}\"]`);\n        if (option) {\n          this.storeSelect.value = this.settings.lastStore;\n        }\n      }\n      \n      // Pre-fill confidence\n      if (this.confidenceSelect) {\n        this.confidenceSelect.value = this.settings.autoFillConfidence;\n      }\n      \n      // Show modal\n      this.modal!.style.display = 'flex';\n      \n      // Focus on price input for quick entry\n      setTimeout(() => {\n        if (this.priceInput) {\n          this.priceInput.focus();\n        }\n      }, 100);\n      \n    } catch (error) {\n      console.error('Error opening price modal:', error);\n      alert('Failed to load price form. Please try again.');\n    }\n  }\n\n  public closeModal(): void {\n    if (this.modal) {\n      this.modal.style.display = 'none';\n    }\n  }\n\n  // AJAX form submission\n  private async handleFormSubmit(e: Event): Promise<void> {\n    e.preventDefault();\n    \n    if (!this.submitButton) return;\n    \n    const form = e.target as HTMLFormElement;\n    const formData = new FormData(form);\n    \n    // Disable submit button during submission\n    this.submitButton.disabled = true;\n    this.submitButton.textContent = 'Saving...';\n    \n    try {\n      const response = await fetch(form.action, {\n        method: 'POST',\n        body: formData,\n        headers: {\n          'X-Requested-With': 'XMLHttpRequest',\n        }\n      });\n      \n      if (response.ok) {\n        // Success - remember settings and close modal\n        if (this.storeSelect && this.storeSelect.value && this.storeSelect.value !== '__add_new__') {\n          this.settings.lastStore = this.storeSelect.value;\n        }\n        \n        if (this.confidenceSelect) {\n          this.settings.autoFillConfidence = this.confidenceSelect.value;\n        }\n        \n        // Add price to recent prices for suggestions\n        if (this.priceInput && this.priceInput.value) {\n          const price = parseFloat(this.priceInput.value);\n          if (price > 0) {\n            this.settings.recentPrices.unshift(price);\n            this.settings.recentPrices = this.settings.recentPrices.slice(0, 5); // Keep only 5 recent\n          }\n        }\n        \n        this.saveSettings();\n        this.closeModal();\n        \n        // Show success message\n        this.showToast('Price added successfully!', 'success');\n        \n        // Refresh the page or update the price display\n        window.location.reload();\n        \n      } else {\n        // Handle form errors\n        const html = await response.text();\n        const modalBody = this.modal!.querySelector('#price-modal-body');\n        if (modalBody) {\n          modalBody.innerHTML = html;\n          this.setupElements();\n          this.setupEventListeners();\n        }\n      }\n      \n    } catch (error) {\n      console.error('Error submitting form:', error);\n      this.showToast('Failed to save price. Please try again.', 'error');\n    } finally {\n      // Re-enable submit button\n      if (this.submitButton) {\n        this.submitButton.disabled = false;\n        this.submitButton.textContent = 'Save Price';\n      }\n    }\n  }\n\n  private showToast(message: string, type: 'success' | 'error'): void {\n    const toast = document.createElement('div');\n    toast.className = `toast toast-${type}`;\n    toast.textContent = message;\n    toast.style.cssText = `\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      padding: 12px 24px;\n      border-radius: 4px;\n      color: white;\n      font-weight: 500;\n      z-index: 10000;\n      transform: translateX(100%);\n      transition: transform 0.3s ease;\n      ${type === 'success' ? 'background: #28a745;' : 'background: #dc3545;'}\n    `;\n    \n    document.body.appendChild(toast);\n    \n    // Animate in\n    setTimeout(() => {\n      toast.style.transform = 'translateX(0)';\n    }, 10);\n    \n    // Remove after delay\n    setTimeout(() => {\n      toast.style.transform = 'translateX(100%)';\n      setTimeout(() => {\n        document.body.removeChild(toast);\n      }, 300);\n    }, 3000);\n  }\n}\n\n// Initialize when DOM is loaded or immediately if already loaded\nfunction initializePriceFormModal() {\n  new PriceFormModalManager();\n}\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initializePriceFormModal);\n} else {\n  // DOM is already loaded\n  initializePriceFormModal();\n} "],"names":["PriceFormModalManager","modal","addStoreDiv","storeSelect","storeNameInput","priceInput","quantityInput","confidenceSelect","pricePerUnitDisplay","priceValidationMessage","submitButton","historicalPrices","currentItemId","currentListId","settings","constructor","this","loadSettings","initialize","setupElements","setupEventListeners","setupPriceCalculator","setupKeyboardShortcuts","setupMobileOptimizations","createModal","toggleAddStoreSection","saved","localStorage","getItem","JSON","parse","lastStore","recentPrices","autoFillConfidence","saveSettings","setItem","stringify","document","getElementById","querySelector","priceContainer","parentElement","pricePerUnitDiv","createElement","id","className","innerHTML","appendChild","validationDiv","body","styles","textContent","head","addEventListener","onStoreChange","bind","onPriceInput","validatePrice","calculatePricePerUnit","form","handleFormSubmit","e","target","closeModal","querySelectorAll","forEach","input","HTMLInputElement","HTMLSelectElement","style","fontSize","parseFloat","getComputedStyle","passive","window","setQuickPrice","openPriceModal","openModal","closePriceModal","ctrlKey","metaKey","key","submit","display","clearValidationMessage","price","value","quantity","parseInt","pricePerUnitSpan","pricePerUnit","toFixed","isNaN","showValidationMessage","length","avgPrice","reduce","sum","p","message","type","required","focus","setHistoricalPrices","prices","itemId","listId","priceId","url","response","fetch","headers","ok","Error","html","text","modalBody","setTimeout","error","console","alert","preventDefault","formData","FormData","disabled","action","method","unshift","slice","showToast","location","reload","toast","cssText","transform","removeChild","initializePriceFormModal","readyState"],"sourceRoot":""}